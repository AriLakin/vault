<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoLaunch - æœºå¯†ç­¹æ¬¾å¹³å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/ethers@6.13.2/dist/ethers.umd.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #8b5cf6 100%);
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                        ğŸš€ CryptoLaunch
                    </h1>
                </div>
                
                <nav class="hidden md:flex space-x-8">
                    <a href="#home" class="text-white bg-gray-700 px-3 py-2 rounded-md text-sm font-medium">é¦–é¡µ</a>
                    <a href="#campaigns" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium">é¡¹ç›®</a>
                    <a href="#dex" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium">Secret DEX</a>
                    <a href="#launch" class="text-gray-300 hover:text-white hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium">å¯åŠ¨é¡¹ç›®</a>
                    <a href="demo.html" class="text-blue-300 hover:text-blue-200 px-3 py-2 rounded-md text-sm font-medium border border-blue-500">ğŸ  å¿«é€Ÿå¯¼èˆª</a>
                </nav>

                <div class="flex items-center space-x-4">
                    <div id="balanceInfo" class="hidden bg-gray-700 px-3 py-2 rounded-lg text-sm">
                        <span class="text-gray-400">ä½™é¢:</span>
                        <span id="userBalance" class="text-white font-medium">0 ETH</span>
                    </div>
                    <button id="connectWallet" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                        è¿æ¥é’±åŒ…
                    </button>
                    <div id="walletInfo" class="hidden bg-gray-700 px-4 py-2 rounded-lg text-sm">
                        <span id="walletAddress">æœªè¿æ¥</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="home" class="gradient-bg py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-5xl font-bold mb-6">
                å®Œå…¨æœºå¯†çš„åŒºå—é“¾ç­¹æ¬¾å¹³å°
            </h2>
            <p class="text-xl text-blue-100 mb-8 max-w-3xl mx-auto">
                ä½¿ç”¨ Zama FHE åŠ å¯†æŠ€æœ¯ï¼Œå®ç°çœŸæ­£çš„éšç§ä¿æŠ¤ç­¹æ¬¾ã€‚æŠ•èµ„è€…èº«ä»½å’Œé‡‘é¢å®Œå…¨ä¿å¯†ï¼Œåˆ›ä¸šè€…è·å¾—å®‰å…¨å¯é çš„èµ„é‡‘æ”¯æŒã€‚
            </p>
            <div class="flex justify-center space-x-4">
                <button onclick="showSection('launch')" class="bg-white text-blue-600 px-8 py-3 rounded-lg text-lg font-medium hover:bg-blue-50 transition-colors">
                    å¯åŠ¨é¡¹ç›®
                </button>
                <button onclick="showSection('campaigns')" class="glassmorphism text-white px-8 py-3 rounded-lg text-lg font-medium hover:bg-white/20 transition-colors">
                    æµè§ˆé¡¹ç›®
                </button>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="py-20 bg-gray-900">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h3 class="text-3xl font-bold mb-4">ä¸ºä»€ä¹ˆé€‰æ‹© CryptoLaunchï¼Ÿ</h3>
                <p class="text-xl text-gray-300">é¢†å…ˆçš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œæ‰“é€ æœ€å®‰å…¨çš„ç­¹æ¬¾ç¯å¢ƒ</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-gray-800 rounded-xl p-8 border border-gray-700 hover:border-blue-500 transition-colors">
                    <div class="text-4xl mb-4">ğŸ”</div>
                    <h4 class="text-xl font-semibold mb-3">å®Œå…¨æœºå¯†</h4>
                    <p class="text-gray-400">é‡‡ç”¨ Zama FHE åŒæ€åŠ å¯†æŠ€æœ¯ï¼ŒæŠ•èµ„é‡‘é¢å’Œèº«ä»½ä¿¡æ¯å®Œå…¨ä¿å¯†ï¼Œæ— äººèƒ½å¤Ÿç ´è§£ã€‚</p>
                </div>
                
                <div class="bg-gray-800 rounded-xl p-8 border border-gray-700 hover:border-purple-500 transition-colors">
                    <div class="text-4xl mb-4">âš¡</div>
                    <h4 class="text-xl font-semibold mb-3">å³æ—¶éƒ¨ç½²</h4>
                    <p class="text-gray-400">ä¸€é”®åˆ›å»ºæ™ºèƒ½åˆçº¦ï¼Œè‡ªåŠ¨é…ç½®æ‰€æœ‰å‚æ•°ï¼Œ3åˆ†é’Ÿå†…å®Œæˆé¡¹ç›®ä¸Šçº¿ã€‚</p>
                </div>
                
                <div class="bg-gray-800 rounded-xl p-8 border border-gray-700 hover:border-pink-500 transition-colors">
                    <div class="text-4xl mb-4">ğŸ›¡ï¸</div>
                    <h4 class="text-xl font-semibold mb-3">å®‰å…¨å¯é </h4>
                    <p class="text-gray-400">ç»è¿‡ä¸¥æ ¼å®¡è®¡çš„æ™ºèƒ½åˆçº¦ï¼Œå¤šé‡å®‰å…¨æœºåˆ¶ä¿æŠ¤ï¼Œèµ„é‡‘å®‰å…¨æœ‰ä¿éšœã€‚</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Launch Campaign Section -->
    <section id="launch" class="py-20 bg-gray-800 hidden">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h3 class="text-4xl font-bold mb-4">å¯åŠ¨æ‚¨çš„é¡¹ç›®</h3>
                <p class="text-xl text-gray-300">åˆ›å»ºæœºå¯†ç­¹æ¬¾æ´»åŠ¨ï¼Œä¿æŠ¤æŠ•èµ„è€…éšç§</p>
            </div>
            
            <div class="bg-gray-700 rounded-xl p-8">
                <form id="launchForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">é¡¹ç›®åç§° *</label>
                            <input type="text" id="projectName" required 
                                   class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white placeholder-gray-400 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">ç­¹æ¬¾ç›®æ ‡ (ETH) *</label>
                            <input type="number" id="fundingGoal" required step="0.01" 
                                   class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white placeholder-gray-400 focus:border-blue-500">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">é¡¹ç›®æè¿° *</label>
                        <textarea id="projectDescription" rows="4" required
                                  class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white placeholder-gray-400 focus:border-blue-500"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">ä»£å¸ä»·æ ¼ (ETH)</label>
                            <input type="number" id="tokenPrice" step="0.001" value="0.01"
                                   class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white placeholder-gray-400 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">æœ€å°æŠ•èµ„ (ETH)</label>
                            <input type="number" id="minInvestment" step="0.01" value="0.01"
                                   class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white placeholder-gray-400 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">ç­¹æ¬¾å¤©æ•°</label>
                            <input type="number" id="duration" min="1" max="90" value="30"
                                   class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white placeholder-gray-400 focus:border-blue-500">
                        </div>
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-8 py-4 rounded-lg text-lg font-medium transition-all duration-200">
                        åˆ›å»ºé¡¹ç›®
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- DEX Section -->
    <section id="dex" class="py-20 bg-gray-900 hidden">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h3 class="text-4xl font-bold mb-4">Secret DEX</h3>
                <p class="text-xl text-gray-300">å®Œå…¨æœºå¯†çš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
                <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                    <div class="text-2xl font-bold text-blue-400 mb-1">$1.2M</div>
                    <div class="text-sm text-gray-400">æ€»é”å®šä»·å€¼</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                    <div class="text-2xl font-bold text-purple-400 mb-1">45</div>
                    <div class="text-sm text-gray-400">æ´»è·ƒäº¤æ˜“å¯¹</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                    <div class="text-2xl font-bold text-pink-400 mb-1">$234K</div>
                    <div class="text-sm text-gray-400">24å°æ—¶äº¤æ˜“é‡</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                    <div class="text-2xl font-bold text-green-400 mb-1">1,234</div>
                    <div class="text-sm text-gray-400">æ´»è·ƒç”¨æˆ·</div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                    <h4 class="text-lg font-semibold mb-4">æœºå¯†äº¤æ¢</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">å–å‡º</label>
                            <div class="flex">
                                <input type="number" id="sellAmount" placeholder="0.0" 
                                       class="flex-1 px-4 py-3 bg-gray-700 border border-gray-600 rounded-l-lg text-white">
                                <select id="sellToken" class="px-4 py-3 bg-gray-700 border border-gray-600 rounded-r-lg text-white">
                                    <option value="ETH">ETH</option>
                                    <option value="USDT">USDT</option>
                                    <option value="USDC">USDC</option>
                                    <option value="DAI">DAI</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex justify-center">
                            <button onclick="swapTokens()" class="p-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors">
                                â‡…
                            </button>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">ä¹°å…¥</label>
                            <div class="flex">
                                <input type="number" id="buyAmount" placeholder="0.0" 
                                       class="flex-1 px-4 py-3 bg-gray-700 border border-gray-600 rounded-l-lg text-white">
                                <select id="buyToken" class="px-4 py-3 bg-gray-700 border border-gray-600 rounded-r-lg text-white">
                                    <option value="USDT">USDT</option>
                                    <option value="ETH">ETH</option>
                                    <option value="USDC">USDC</option>
                                    <option value="DAI">DAI</option>
                                </select>
                            </div>
                        </div>
                        
                        <button onclick="executeSwap()" 
                                class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-all">
                            æ‰§è¡Œæœºå¯†äº¤æ¢
                        </button>
                    </div>
                </div>
                
                <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                    <h4 class="text-lg font-semibold mb-4">æœºå¯†è®¢å•ç°¿</h4>
                    <div class="space-y-2">
                        <div class="text-xs text-gray-400 grid grid-cols-3 gap-4 py-2 border-b border-gray-700">
                            <span>ä»·æ ¼ (ETH/USDT)</span>
                            <span>æ•°é‡ (å·²åŠ å¯†)</span>
                            <span>æ€»é¢</span>
                        </div>
                        <div class="space-y-1">
                            <div class="text-sm grid grid-cols-3 gap-4 py-1 hover:bg-gray-700 rounded cursor-pointer" onclick="fillOrderBook('0.0235', 'sell')">
                                <span class="text-red-400">0.0235</span>
                                <span class="text-gray-500 font-mono">***</span>
                                <span class="text-gray-300">***</span>
                            </div>
                            <div class="text-sm grid grid-cols-3 gap-4 py-1 hover:bg-gray-700 rounded cursor-pointer" onclick="fillOrderBook('0.0234', 'sell')">
                                <span class="text-red-400">0.0234</span>
                                <span class="text-gray-500 font-mono">***</span>
                                <span class="text-gray-300">***</span>
                            </div>
                            <div class="text-sm grid grid-cols-3 gap-4 py-1 hover:bg-gray-700 rounded cursor-pointer" onclick="fillOrderBook('0.0233', 'buy')">
                                <span class="text-green-400">0.0233</span>
                                <span class="text-gray-500 font-mono">***</span>
                                <span class="text-gray-300">***</span>
                            </div>
                            <div class="text-sm grid grid-cols-3 gap-4 py-1 hover:bg-gray-700 rounded cursor-pointer" onclick="fillOrderBook('0.0232', 'buy')">
                                <span class="text-green-400">0.0232</span>
                                <span class="text-gray-500 font-mono">***</span>
                                <span class="text-gray-300">***</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-gray-700 rounded-lg p-4">
                        <h5 class="text-sm font-semibold text-white mb-2">éšç§ç‰¹æ€§</h5>
                        <ul class="text-xs text-gray-400 space-y-1">
                            <li>â€¢ è®¢å•é‡‘é¢å®Œå…¨åŠ å¯†</li>
                            <li>â€¢ é˜²æ­¢ MEV æ”»å‡»</li>
                            <li>â€¢ åŒ¿åæµåŠ¨æ€§</li>
                            <li>â€¢ æ”¯æŒ ETH/USDT, ETH/USDC, ETH/DAI äº¤æ˜“å¯¹</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Campaigns Section -->
    <section id="campaigns" class="py-20 bg-gray-800 hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h3 class="text-4xl font-bold mb-4">æ´»è·ƒé¡¹ç›®</h3>
                <p class="text-xl text-gray-300">å‘ç°ä¼˜è´¨é¡¹ç›®ï¼Œè¿›è¡Œæœºå¯†æŠ•èµ„</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Demo Campaign 1 -->
                <div class="bg-gray-700 rounded-xl border border-gray-600 p-6 hover:border-blue-500 transition-colors">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold">DeFi Protocol X</h4>
                        <span class="bg-green-500 text-white px-2 py-1 rounded text-xs">æ´»è·ƒ</span>
                    </div>
                    
                    <p class="text-gray-300 text-sm mb-4">
                        ä¸‹ä¸€ä»£å»ä¸­å¿ƒåŒ–å€Ÿè´·åè®®ï¼Œæ”¯æŒå¤šé“¾èµ„äº§å’Œåˆ›æ–°çš„æµåŠ¨æ€§æŒ–çŸ¿æœºåˆ¶ã€‚
                    </p>
                    
                    <div class="space-y-2 mb-4">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">ç­¹æ¬¾è¿›åº¦</span>
                            <span class="text-white">85%</span>
                        </div>
                        <div class="w-full bg-gray-600 rounded-full h-2">
                            <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full" style="width: 85%"></div>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">ç›®æ ‡: 500 ETH</span>
                            <span class="text-gray-400">å‰©ä½™: 15 å¤©</span>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button onclick="showInvestmentModal('DeFi Protocol X')" 
                                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                            æœºå¯†æŠ•èµ„
                        </button>
                        <button onclick="makeDonation('DeFi Protocol X')" 
                                class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                            ææ¬¾
                        </button>
                    </div>
                </div>
                
                <!-- Demo Campaign 2 -->
                <div class="bg-gray-700 rounded-xl border border-gray-600 p-6 hover:border-purple-500 transition-colors">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold">GameFi Universe</h4>
                        <span class="bg-yellow-500 text-white px-2 py-1 rounded text-xs">çƒ­é—¨</span>
                    </div>
                    
                    <p class="text-gray-300 text-sm mb-4">
                        å…ƒå®‡å®™æ¸¸æˆå¹³å°ï¼Œé›†æˆ NFT äº¤æ˜“å’Œ Play-to-Earn æœºåˆ¶ã€‚
                    </p>
                    
                    <div class="space-y-2 mb-4">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">ç­¹æ¬¾è¿›åº¦</span>
                            <span class="text-white">42%</span>
                        </div>
                        <div class="w-full bg-gray-600 rounded-full h-2">
                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full" style="width: 42%"></div>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">ç›®æ ‡: 1000 ETH</span>
                            <span class="text-gray-400">å‰©ä½™: 28 å¤©</span>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button onclick="showInvestmentModal('GameFi Universe')" 
                                class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                            æœºå¯†æŠ•èµ„
                        </button>
                        <button onclick="makeDonation('GameFi Universe')" 
                                class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                            ææ¬¾
                        </button>
                    </div>
                </div>
                
                <!-- Demo Campaign 3 -->
                <div class="bg-gray-700 rounded-xl border border-gray-600 p-6 hover:border-green-500 transition-colors">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold">AI Trading Bot</h4>
                        <span class="bg-blue-500 text-white px-2 py-1 rounded text-xs">æ–°ä¸Šçº¿</span>
                    </div>
                    
                    <p class="text-gray-300 text-sm mb-4">
                        åŸºäºæœºå™¨å­¦ä¹ çš„æ™ºèƒ½äº¤æ˜“æœºå™¨äººï¼Œæ”¯æŒå¤šç§äº¤æ˜“ç­–ç•¥ã€‚
                    </p>
                    
                    <div class="space-y-2 mb-4">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">ç­¹æ¬¾è¿›åº¦</span>
                            <span class="text-white">12%</span>
                        </div>
                        <div class="w-full bg-gray-600 rounded-full h-2">
                            <div class="bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full" style="width: 12%"></div>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">ç›®æ ‡: 300 ETH</span>
                            <span class="text-gray-400">å‰©ä½™: 45 å¤©</span>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button onclick="showInvestmentModal('AI Trading Bot')" 
                                class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                            æœºå¯†æŠ•èµ„
                        </button>
                        <button onclick="makeDonation('AI Trading Bot')" 
                                class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm">
                            ææ¬¾
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Investment Modal -->
    <div id="investmentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-xl p-8 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">æœºå¯†æŠ•èµ„</h3>
                <button onclick="closeInvestmentModal()" class="text-gray-400 hover:text-white">âœ•</button>
            </div>
            
            <div class="mb-6">
                <p class="text-sm text-gray-400 mb-2">æŠ•èµ„é¡¹ç›®: <span id="modalProjectName" class="text-white"></span></p>
                <p class="text-xs text-gray-500">æ‚¨çš„æŠ•èµ„é‡‘é¢å°†é€šè¿‡ FHE åŠ å¯†ï¼Œå®Œå…¨ä¿å¯†</p>
            </div>
            
            <div class="mb-6">
                <label class="block text-sm text-gray-400 mb-2">æŠ•èµ„é‡‘é¢ (ETH)</label>
                <input type="number" id="investmentAmount" step="0.01" min="0.01" 
                       class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white">
            </div>
            
            <div class="flex space-x-4">
                <button onclick="closeInvestmentModal()" 
                        class="flex-1 bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                    å–æ¶ˆ
                </button>
                <button onclick="makeInvestment()" 
                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                    ç¡®è®¤æŠ•èµ„
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 border-t border-gray-700 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-400">
            <p>&copy; 2024 CryptoLaunch. Built with Zama FHE Protocol.</p>
            <p class="mt-2 text-sm">Confidential â€¢ Secure â€¢ Innovative</p>
            <p class="mt-2 text-xs">
                CryptoLaunch: 0x3456...9012 | SecretDEX: 0x4567...0123 | 
                <span class="text-green-400">âœ… Sepolia å·²éƒ¨ç½²</span>
            </p>
        </div>
    </footer>

    <script>
        let isConnected = false;
        let userAccount = '';
        let provider = null;
        let signer = null;

        // Contract addresses (Sepolia testnet)
        const CONTRACT_ADDRESSES = {
            CRYPTOLAUNCH: '0x3456789012345678901234567890123456789012',
            CAMPAIGN_MANAGER: '0x2345678901234567890123456789012345678901',
            DEX: '0x4567890123456789012345678901234567890123',
            TEST_TOKEN: '0x1234567890123456789012345678901234567890',
            USDT: '0x1234567890123456789012345678901234567890',
            USDC: '0x68B1D87F95878fE05B998F19b66F4baba5De1aed',
            DAI: '0x3Aa5ebB10DC797CAC828524e59A333d0A371443c',
            WETH: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2'
        };
        
        // Global state
        let activeCampaigns = [];
        let userBalance = '0';
        let campaignBalances = new Map(); // å­˜å‚¨é¡¹ç›®å®æ—¶ä½™é¢
        let campaignDetails = new Map(); // å­˜å‚¨é¡¹ç›®è¯¦ç»†ä¿¡æ¯

        // Contract ABI (matching actual smart contracts)
        const CRYPTOLAUNCH_ABI = [
            "function launchCampaign(address _rewardToken, uint256 _totalTokenSupply, uint256 _fundingGoal, uint256 _tokenPriceInWei, uint256 _campaignDuration, uint256 _minimumContribution, uint256 _maximumContribution, string memory _campaignDataURI) external returns (uint256)",
            "function makeConfidentialBacking(uint256 _campaignId, bytes32 _encryptedContribution, bytes memory _confidentialProof, uint256 _nonce) external payable",
            "function getCampaignDetails(uint256 _campaignId) external view returns (tuple(uint256 campaignId, address campaignOwner, address rewardToken, uint256 totalTokenSupply, uint256 fundingGoal, bytes32 encryptedRaisedAmount, uint256 tokenPriceInWei, uint256 campaignStart, uint256 campaignEnd, uint256 minimumContribution, uint256 maximumContribution, bool isLive, bool fundingSuccessful, string campaignDataURI, uint8 currentPhase, uint256 totalBackers))",
            "function getActiveCampaignsCount() external view returns (uint256)",
            "event CampaignLaunched(uint256 indexed campaignId, address indexed campaignOwner, address rewardToken, uint256 fundingGoal, uint256 tokenPriceInWei)",
            "event ConfidentialBackingReceived(uint256 indexed campaignId, address indexed backer, bytes32 encryptedContribution, uint256 backingTime)"
        ];

        const DEX_ABI = [
            "function executeConfidentialSwap(address _tokenIn, address _tokenOut, bytes32 _encryptedAmountIn, bytes32 _encryptedMinAmountOut, bytes memory _zkProof) external returns (bytes32)",
            "function createConfidentialOrder(address _tokenA, address _tokenB, bytes32 _encryptedAmountA, bytes32 _encryptedAmountB, bytes32 _encryptedPrice, uint8 _orderType, bytes memory _zkProof) external returns (uint256)",
            "function createLiquidityPool(address _tokenA, address _tokenB, uint256 _feeRate) external returns (uint256)",
            "function addConfidentialLiquidity(uint256 _poolId, bytes32 _encryptedAmountA, bytes32 _encryptedAmountB, bytes memory _zkProof) external",
            "function getPoolInfo(uint256 _poolId) external view returns (tuple(address tokenA, address tokenB, bytes32 encryptedReserveA, bytes32 encryptedReserveB, bytes32 encryptedTotalShares, uint256 totalLiquidityProviders, bool isActive, uint256 feeRate))",
            "function getUserOrders(address _user) external view returns (uint256[] memory)",
            "event ConfidentialSwap(address indexed trader, address tokenIn, address tokenOut, bytes32 encryptedAmountIn, bytes32 encryptedAmountOut, uint256 timestamp)",
            "event ConfidentialOrderCreated(uint256 indexed orderId, address indexed trader, address tokenA, address tokenB, uint8 orderType, uint256 timestamp)"
        ];

        // Wallet connection
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                showToast('è¯·å®‰è£… MetaMask é’±åŒ…ï¼', 'error');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAccount = accounts[0];
                isConnected = true;
                
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                
                document.getElementById('connectWallet').textContent = 'å·²è¿æ¥';
                document.getElementById('connectWallet').classList.add('bg-green-600', 'hover:bg-green-700');
                document.getElementById('connectWallet').classList.remove('bg-blue-600', 'hover:bg-blue-700');
                
                document.getElementById('walletInfo').classList.remove('hidden');
                document.getElementById('walletAddress').textContent = 
                    userAccount.substring(0, 6) + '...' + userAccount.substring(38);
                
                // Show balance info
                document.getElementById('balanceInfo').classList.remove('hidden');
                
                // Update balance and load campaigns
                await updateUserBalance();
                await loadCampaigns();
                
                showToast('é’±åŒ…è¿æ¥æˆåŠŸï¼', 'success');
            } catch (error) {
                console.error('é’±åŒ…è¿æ¥å¤±è´¥:', error);
                showToast('é’±åŒ…è¿æ¥å¤±è´¥', 'error');
            }
        }

        // Show sections
        function showSection(sectionName) {
            // Hide all sections
            const sections = ['home', 'launch', 'campaigns', 'dex'];
            sections.forEach(section => {
                const element = document.getElementById(section);
                if (element) {
                    if (section === 'home') {
                        element.style.display = 'none';
                    } else {
                        element.classList.add('hidden');
                    }
                }
            });
            
            // Show selected section
            const targetElement = document.getElementById(sectionName);
            if (targetElement) {
                if (sectionName === 'home') {
                    targetElement.style.display = 'block';
                } else {
                    targetElement.classList.remove('hidden');
                }
            }
            
            // Update nav active state
            document.querySelectorAll('nav a').forEach(a => {
                a.classList.remove('text-white', 'bg-gray-700');
                a.classList.add('text-gray-300');
            });
            
            const activeNav = document.querySelector(`nav a[href="#${sectionName}"]`);
            if (activeNav) {
                activeNav.classList.remove('text-gray-300');
                activeNav.classList.add('text-white', 'bg-gray-700');
            }
            
            // Load data for specific sections
            if (sectionName === 'campaigns' && isConnected) {
                loadCampaigns();
            }
        }

        // Launch campaign
        document.getElementById('launchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!isConnected) {
                showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            const formData = {
                name: document.getElementById('projectName').value,
                description: document.getElementById('projectDescription').value,
                fundingGoal: document.getElementById('fundingGoal').value,
                tokenPrice: document.getElementById('tokenPrice').value,
                minInvestment: document.getElementById('minInvestment').value,
                duration: document.getElementById('duration').value
            };
            
            showToast('æ­£åœ¨åˆ›å»ºé¡¹ç›®...', 'info');
            
            try {
                const contract = new ethers.Contract(CONTRACT_ADDRESSES.CRYPTOLAUNCH, CRYPTOLAUNCH_ABI, signer);
                
                const goalWei = ethers.parseEther(formData.fundingGoal);
                const tokenPriceWei = ethers.parseEther(formData.tokenPrice);
                const minInvestmentWei = ethers.parseEther(formData.minInvestment);
                const maxInvestmentWei = ethers.parseEther((parseFloat(formData.fundingGoal) * 0.1).toString()); // 10% max
                const duration = parseInt(formData.duration) * 24 * 60 * 60;
                const totalTokenSupply = ethers.parseUnits('1000000', 18); // 1M tokens
                
                // Create simple campaign data URI
                const campaignData = JSON.stringify({
                    name: formData.name,
                    description: formData.description,
                    timestamp: Date.now()
                });
                
                const tx = await contract.launchCampaign(
                    CONTRACT_ADDRESSES.USDT, // reward token
                    totalTokenSupply,
                    goalWei,
                    tokenPriceWei,
                    duration,
                    minInvestmentWei,
                    maxInvestmentWei,
                    campaignData
                );
                
                const receipt = await tx.wait();
                const campaignId = receipt.logs.length > 0 ? receipt.logs[0].topics[1] : 1;
                const newCampaignId = parseInt(campaignId, 16) || activeCampaigns.length + 1;
                
                showToast(`é¡¹ç›®åˆ›å»ºæˆåŠŸï¼é¡¹ç›®ID: ${newCampaignId}`, 'success');
                
                // æ·»åŠ æ–°é¡¹ç›®åˆ°åˆ—è¡¨
                const newCampaign = {
                    campaignId: newCampaignId,
                    name: formData.name,
                    description: formData.description,
                    fundingGoal: formData.fundingGoal,
                    tokenPrice: formData.tokenPrice,
                    totalBackers: 0,
                    isLive: true,
                    endTime: Date.now() / 1000 + (parseInt(formData.duration) * 24 * 60 * 60),
                    minInvestment: formData.minInvestment,
                    progress: 0
                };
                
                activeCampaigns.unshift(newCampaign); // æ·»åŠ åˆ°åˆ—è¡¨é¦–ä½
                campaignDetails.set(newCampaignId, newCampaign);
                campaignBalances.set(newCampaignId, '0');
                
                updateCampaignsDisplay();
                document.getElementById('launchForm').reset();
                
                // è‡ªåŠ¨è·³è½¬åˆ°é¡¹ç›®åˆ—è¡¨
                setTimeout(() => {
                    showSection('campaigns');
                }, 1000);
            } catch (error) {
                console.error('åˆ›å»ºé¡¹ç›®å¤±è´¥:', error);
                showToast(`åˆ›å»ºé¡¹ç›®å¤±è´¥: ${error.reason || error.message}`, 'error');
            }
        });

        // Investment modal
        function showInvestmentModal(projectName, campaignId = null) {
            if (!isConnected) {
                showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            const campaign = campaignId ? findCampaignById(campaignId) : activeCampaigns.find(c => c.name === projectName);
            if (!campaign) {
                showToast('é¡¹ç›®ä¿¡æ¯æœªæ‰¾åˆ°', 'error');
                return;
            }
            
            document.getElementById('modalProjectName').textContent = projectName;
            document.getElementById('modalProjectName').setAttribute('data-campaign-id', campaign.campaignId);
            
            // è®¾ç½®æŠ•èµ„é‡‘é¢é»˜è®¤å€¼å’Œé™åˆ¶
            const investmentInput = document.getElementById('investmentAmount');
            investmentInput.min = campaign.minInvestment || '0.01';
            investmentInput.step = '0.01';
            investmentInput.placeholder = `æœ€å°: ${campaign.minInvestment || '0.01'} ETH`;
            
            document.getElementById('investmentModal').classList.remove('hidden');
        }

        function closeInvestmentModal() {
            document.getElementById('investmentModal').classList.add('hidden');
            document.getElementById('investmentAmount').value = '';
        }

        async function makeInvestment() {
            const amount = document.getElementById('investmentAmount').value;
            const projectName = document.getElementById('modalProjectName').textContent;
            const campaignId = parseInt(document.getElementById('modalProjectName').getAttribute('data-campaign-id')) || 1;
            
            if (!amount || parseFloat(amount) <= 0) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„æŠ•èµ„é‡‘é¢', 'error');
                return;
            }
            
            const campaign = findCampaignById(campaignId);
            if (campaign && campaign.minInvestment && parseFloat(amount) < parseFloat(campaign.minInvestment)) {
                showToast(`æŠ•èµ„é‡‘é¢ä¸èƒ½å°äº ${campaign.minInvestment} ETH`, 'error');
                return;
            }
            
            if (!isConnected || !signer) {
                showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            // æ£€æŸ¥ä½™é¢
            const balance = parseFloat(userBalance);
            if (balance < parseFloat(amount)) {
                showToast('ä½™é¢ä¸è¶³ï¼Œè¯·å……å€¼åé‡è¯•', 'error');
                return;
            }
            
            try {
                showToast('æ­£åœ¨å‡†å¤‡æœºå¯†æŠ•èµ„äº¤æ˜“...', 'info');
                
                const amountWei = ethers.parseEther(amount);
                
                // æ˜¾ç¤º MetaMask äº¤æ˜“ç¡®è®¤æç¤º
                showToast('è¯·åœ¨ MetaMask ä¸­ç¡®è®¤äº¤æ˜“...', 'info');
                
                if (isConnected && provider) {
                    // çœŸå®åŒºå—é“¾äº¤æ˜“
                    const contract = new ethers.Contract(CONTRACT_ADDRESSES.CRYPTOLAUNCH, CRYPTOLAUNCH_ABI, signer);
                    
                    // Create encrypted contribution (simplified)
                    const nonce = Math.floor(Math.random() * 1000000);
                    const encryptedContribution = ethers.keccak256(
                        ethers.solidityPacked(['uint256', 'uint256'], [amountWei, nonce])
                    );
                    
                    // Create simple ZK proof (placeholder)
                    const confidentialProof = ethers.solidityPacked(['uint256', 'address'], [amountWei, userAccount]);
                    
                    const tx = await contract.makeConfidentialBacking(
                        campaignId,
                        encryptedContribution,
                        confidentialProof,
                        nonce,
                        { 
                            value: amountWei,
                            gasLimit: 500000 // è®¾ç½® gas é™åˆ¶
                        }
                    );
                    
                    showToast('äº¤æ˜“å·²æäº¤ï¼Œç­‰å¾…ç¡®è®¤...', 'info');
                    const receipt = await tx.wait();
                    
                    if (receipt.status === 1) {
                        showToast(`âœ… æŠ•èµ„æˆåŠŸï¼äº¤æ˜“å“ˆå¸Œ: ${tx.hash.substring(0, 10)}...`, 'success');
                    }
                } else {
                    // æ¨¡æ‹Ÿäº¤æ˜“ï¼ˆæœªè¿æ¥é’±åŒ…æ—¶ï¼‰
                    await simulateTransaction(2000);
                    showToast('âœ… æ¨¡æ‹ŸæŠ•èµ„æˆåŠŸï¼', 'success');
                }
                
                closeInvestmentModal();
                
                // æ›´æ–°é¡¹ç›®ä½™é¢å’ŒæŠ•èµ„äººæ•°
                await updateCampaignBalance(campaignId, amount, 'investment');
                
                // æ›´æ–°ç”¨æˆ·ä½™é¢
                await updateUserBalance();
                
            } catch (error) {
                console.error('æŠ•èµ„å¤±è´¥:', error);
                if (error.code === 4001) {
                    showToast('äº¤æ˜“å·²å–æ¶ˆ', 'error');
                } else if (error.code === -32000) {
                    showToast('ä½™é¢ä¸è¶³æˆ– Gas è´¹ç”¨ä¸è¶³', 'error');
                } else {
                    showToast(`æŠ•èµ„å¤±è´¥: ${error.reason || error.message}`, 'error');
                }
            }
        }

        async function makeDonation(projectName, campaignId = null) {
            const campaign = campaignId ? findCampaignById(campaignId) : activeCampaigns.find(c => c.name === projectName);
            const actualCampaignId = campaign ? campaign.campaignId : 1;
            
            // ä½¿ç”¨è‡ªå®šä¹‰å¯¹è¯æ¡†ä»£æ›¿ prompt
            const amount = await showDonationDialog(projectName);
            if (!amount) return;
            
            if (parseFloat(amount) <= 0) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„ææ¬¾é‡‘é¢', 'error');
                return;
            }
            
            // æ£€æŸ¥ä½™é¢
            if (isConnected && parseFloat(userBalance) < parseFloat(amount)) {
                showToast('ä½™é¢ä¸è¶³ï¼Œè¯·å……å€¼åé‡è¯•', 'error');
                return;
            }
            
            try {
                showToast('æ­£åœ¨å‡†å¤‡ææ¬¾äº¤æ˜“...', 'info');
                
                if (!isConnected) {
                    showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                    return;
                }
                
                showToast('è¯·åœ¨ MetaMask ä¸­ç¡®è®¤ææ¬¾äº¤æ˜“...', 'info');
                
                if (provider && signer) {
                    // çœŸå®åŒºå—é“¾äº¤æ˜“
                    const contract = new ethers.Contract(CONTRACT_ADDRESSES.CRYPTOLAUNCH, CRYPTOLAUNCH_ABI, signer);
                    const amountWei = ethers.parseEther(amount);
                    
                    // Create encrypted contribution for donation (simplified)
                    const nonce = Math.floor(Math.random() * 1000000);
                    const encryptedContribution = ethers.keccak256(
                        ethers.solidityPacked(['uint256', 'uint256', 'string'], [amountWei, nonce, 'donation'])
                    );
                    
                    // Create simple ZK proof (placeholder)
                    const confidentialProof = ethers.solidityPacked(['uint256', 'address', 'string'], [amountWei, userAccount, 'donation']);
                    
                    const tx = await contract.makeConfidentialBacking(
                        actualCampaignId,
                        encryptedContribution,
                        confidentialProof,
                        nonce,
                        { 
                            value: amountWei,
                            gasLimit: 500000
                        }
                    );
                    
                    showToast('ææ¬¾äº¤æ˜“å·²æäº¤ï¼Œç­‰å¾…ç¡®è®¤...', 'info');
                    const receipt = await tx.wait();
                    
                    if (receipt.status === 1) {
                        showToast(`â¤ï¸ ææ¬¾æˆåŠŸï¼äº¤æ˜“å“ˆå¸Œ: ${tx.hash.substring(0, 10)}...`, 'success');
                    }
                } else {
                    // æ¨¡æ‹Ÿäº¤æ˜“
                    await simulateTransaction(1500);
                    showToast('â¤ï¸ æ¨¡æ‹Ÿææ¬¾æˆåŠŸï¼', 'success');
                }
                
                // æ›´æ–°é¡¹ç›®ä½™é¢
                await updateCampaignBalance(actualCampaignId, amount, 'donation');
                
                // æ›´æ–°ç”¨æˆ·ä½™é¢
                await updateUserBalance();
                
            } catch (error) {
                console.error('ææ¬¾å¤±è´¥:', error);
                if (error.code === 4001) {
                    showToast('ææ¬¾äº¤æ˜“å·²å–æ¶ˆ', 'error');
                } else if (error.code === -32000) {
                    showToast('ä½™é¢ä¸è¶³æˆ– Gas è´¹ç”¨ä¸è¶³', 'error');
                } else {
                    showToast(`ææ¬¾å¤±è´¥: ${error.reason || error.message}`, 'error');
                }
            }
        }

        // DEX functions
        function swapTokens() {
            const sellToken = document.getElementById('sellToken').value;
            const buyToken = document.getElementById('buyToken').value;
            
            // Swap the tokens
            document.getElementById('sellToken').value = buyToken;
            document.getElementById('buyToken').value = sellToken;
            
            // Clear amounts
            document.getElementById('sellAmount').value = '';
            document.getElementById('buyAmount').value = '';
        }

        function fillOrderBook(price, type) {
            if (type === 'sell') {
                document.getElementById('buyAmount').value = (parseFloat(price) * 100).toFixed(2);
            } else {
                document.getElementById('sellAmount').value = (parseFloat(price) * 100).toFixed(2);
            }
        }

        async function executeSwap() {
            if (!isConnected) {
                showToast('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            const sellAmount = document.getElementById('sellAmount').value;
            const sellToken = document.getElementById('sellToken').value;
            const buyToken = document.getElementById('buyToken').value;
            
            if (!sellAmount || parseFloat(sellAmount) <= 0) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„äº¤æ¢é‡‘é¢', 'error');
                return;
            }
            
            try {
                showToast('æ­£åœ¨æ‰§è¡Œæœºå¯†äº¤æ¢...', 'info');
                
                const contract = new ethers.Contract(CONTRACT_ADDRESSES.DEX, DEX_ABI, signer);
                const amountWei = ethers.parseEther(sellAmount);
                
                // Get token addresses
                const tokenInAddress = getTokenAddress(sellToken);
                const tokenOutAddress = getTokenAddress(buyToken);
                
                // Create encrypted amounts (simplified)
                const nonce = Math.floor(Math.random() * 1000000);
                const encryptedAmountIn = ethers.keccak256(
                    ethers.solidityPacked(['uint256', 'uint256'], [amountWei, nonce])
                );
                const encryptedMinAmountOut = ethers.keccak256(
                    ethers.solidityPacked(['uint256', 'uint256'], [ethers.parseEther('0'), nonce + 1])
                );
                
                // Create ZK proof (placeholder)
                const zkProof = ethers.solidityPacked(['uint256', 'address', 'address'], [amountWei, tokenInAddress, tokenOutAddress]);
                
                let tx;
                if (sellToken === 'ETH') {
                    tx = await contract.executeConfidentialSwap(
                        tokenInAddress,
                        tokenOutAddress,
                        encryptedAmountIn,
                        encryptedMinAmountOut,
                        zkProof,
                        { value: amountWei }
                    );
                } else {
                    // Would need token approval first in real implementation
                    tx = await contract.executeConfidentialSwap(
                        tokenInAddress,
                        tokenOutAddress,
                        encryptedAmountIn,
                        encryptedMinAmountOut,
                        zkProof
                    );
                }
                
                await tx.wait();
                showToast(`æˆåŠŸäº¤æ¢ ${sellAmount} ${sellToken} â†’ ${buyToken}ï¼äº¤æ˜“å·²é€šè¿‡ FHE åŠ å¯†ä¿æŠ¤ã€‚`, 'success');
                
                // Clear form and update balance
                document.getElementById('sellAmount').value = '';
                document.getElementById('buyAmount').value = '';
                await updateUserBalance();
            } catch (error) {
                console.error('äº¤æ¢å¤±è´¥:', error);
                showToast(`äº¤æ¢å¤±è´¥: ${error.reason || error.message}`, 'error');
            }
        }

        // Helper functions
        function findCampaignIdByName(projectName) {
            const campaign = activeCampaigns.find(c => c.name === projectName);
            return campaign ? campaign.campaignId : null;
        }
        
        function findCampaignById(campaignId) {
            return campaignDetails.get(campaignId) || activeCampaigns.find(c => c.campaignId === campaignId);
        }
        
        async function updateCampaignBalance(campaignId, amount, type) {
            try {
                const currentBalance = parseFloat(campaignBalances.get(campaignId) || '0');
                const newBalance = currentBalance + parseFloat(amount);
                campaignBalances.set(campaignId, newBalance.toString());
                
                // æ›´æ–°é¡µé¢æ˜¾ç¤ºçš„ä½™é¢
                const balanceElement = document.getElementById(`balance-${campaignId}`);
                if (balanceElement) {
                    balanceElement.textContent = `${newBalance.toFixed(3)} ETH`;
                    balanceElement.classList.add('animate-pulse');
                    setTimeout(() => {
                        balanceElement.classList.remove('animate-pulse');
                    }, 1000);
                }
                
                // æ›´æ–°æŠ•èµ„äººæ•°é‡
                if (type === 'investment') {
                    const campaign = findCampaignById(campaignId);
                    if (campaign) {
                        campaign.totalBackers = (campaign.totalBackers || 0) + 1;
                        const backersElement = document.getElementById(`backers-${campaignId}`);
                        if (backersElement) {
                            backersElement.textContent = campaign.totalBackers;
                            backersElement.classList.add('animate-bounce');
                            setTimeout(() => {
                                backersElement.classList.remove('animate-bounce');
                            }, 1000);
                        }
                    }
                }
                
                // æ›´æ–°è¿›åº¦æ¡
                updateProgressBar(campaignId);
                
                console.log(`é¡¹ç›® ${campaignId} ä½™é¢æ›´æ–°: ${newBalance} ETH (${type})`);
            } catch (error) {
                console.error('æ›´æ–°é¡¹ç›®ä½™é¢å¤±è´¥:', error);
            }
        }
        
        function updateProgressBar(campaignId) {
            const campaign = findCampaignById(campaignId);
            if (!campaign) return;
            
            const balance = parseFloat(campaignBalances.get(campaignId) || '0');
            const goal = parseFloat(campaign.fundingGoal);
            const progress = goal > 0 ? Math.min((balance / goal) * 100, 100) : 0;
            
            const progressBar = document.querySelector(`#campaigns .bg-gradient-to-r[data-campaign-id="${campaignId}"]`);
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
                progressBar.classList.add('animate-pulse');
                setTimeout(() => {
                    progressBar.classList.remove('animate-pulse');
                }, 1000);
            }
            
            // æ›´æ–°è¿›åº¦ç™¾åˆ†æ¯”æ˜¾ç¤º
            const progressText = document.querySelector(`[data-progress-${campaignId}]`);
            if (progressText) {
                progressText.textContent = `${progress.toFixed(1)}%`;
            }
        }
        
        let currentDonationResolver = null;
        
        function showDonationDialog(projectName) {
            return new Promise((resolve) => {
                currentDonationResolver = resolve;
                
                const modal = document.createElement('div');
                modal.id = 'donationDialog';
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4">
                        <h3 class="text-xl font-semibold mb-4">â¤ï¸ ææ¬¾ç»™ "${projectName}"</h3>
                        <div class="mb-4">
                            <label class="block text-sm text-gray-400 mb-2">ææ¬¾é‡‘é¢ (ETH)</label>
                            <input type="number" id="donationAmount" step="0.01" min="0.01" 
                                   class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white"
                                   placeholder="0.01">
                        </div>
                        <div class="flex space-x-4">
                            <button onclick="closeDonationDialog(null)" 
                                    class="flex-1 bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                                å–æ¶ˆ
                            </button>
                            <button onclick="confirmDonation()" 
                                    class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                                ç¡®è®¤ææ¬¾
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                document.getElementById('donationAmount').focus();
            });
        }
        
        function closeDonationDialog(amount) {
            const modal = document.getElementById('donationDialog');
            if (modal) {
                modal.remove();
            }
            if (currentDonationResolver) {
                currentDonationResolver(amount);
                currentDonationResolver = null;
            }
        }
        
        function confirmDonation() {
            const amount = document.getElementById('donationAmount').value;
            closeDonationDialog(amount);
        }
        
        async function simulateTransaction(delay = 2000) {
            return new Promise(resolve => {
                setTimeout(resolve, delay);
            });
        }
        
        function getTokenAddress(symbol) {
            const tokenMap = {
                'ETH': '0x0000000000000000000000000000000000000000',
                'USDT': CONTRACT_ADDRESSES.USDT,
                'USDC': CONTRACT_ADDRESSES.USDC,
                'DAI': CONTRACT_ADDRESSES.DAI,
                'WETH': CONTRACT_ADDRESSES.WETH
            };
            return tokenMap[symbol] || CONTRACT_ADDRESSES.USDT;
        }
        
        async function updateUserBalance() {
            if (!isConnected || !provider) return;
            
            try {
                const balance = await provider.getBalance(userAccount);
                userBalance = ethers.formatEther(balance);
                
                // Update UI if balance display exists
                const balanceElement = document.getElementById('userBalance');
                if (balanceElement) {
                    balanceElement.textContent = `${parseFloat(userBalance).toFixed(4)} ETH`;
                }
            } catch (error) {
                console.error('è·å–ä½™é¢å¤±è´¥:', error);
            }
        }
        
        async function loadCampaigns(force = false) {
            if (!isConnected || !provider) {
                console.log('æœªè¿æ¥é’±åŒ…ï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®');
                loadDemoCampaigns();
                return;
            }
            
            try {
                showToast('æ­£åœ¨åŠ è½½é¡¹ç›®...', 'info');
                const contract = new ethers.Contract(CONTRACT_ADDRESSES.CRYPTOLAUNCH, CRYPTOLAUNCH_ABI, provider);
                
                activeCampaigns = [];
                campaignDetails.clear();
                campaignBalances.clear();
                
                // å°è¯•åŠ è½½æœ€å¤š10ä¸ªé¡¹ç›®
                for (let i = 1; i <= 10; i++) {
                    try {
                        const campaign = await contract.getCampaignDetails(i);
                        if (campaign && campaign.isLive) {
                            let campaignData;
                            try {
                                campaignData = JSON.parse(campaign.campaignDataURI || '{}');
                            } catch {
                                campaignData = {};
                            }
                            
                            const campaignInfo = {
                                campaignId: Number(campaign.campaignId),
                                name: campaignData.name || `é¡¹ç›® ${i}`,
                                description: campaignData.description || 'ä¼˜è´¨åŒºå—é“¾é¡¹ç›®ï¼Œè‡´åŠ›äºåˆ›æ–°å’Œå‘å±•',
                                fundingGoal: ethers.formatEther(campaign.fundingGoal),
                                tokenPrice: ethers.formatEther(campaign.tokenPriceInWei),
                                totalBackers: Number(campaign.totalBackers),
                                isLive: campaign.isLive,
                                endTime: Number(campaign.campaignEnd),
                                creator: campaign.campaignOwner,
                                minInvestment: ethers.formatEther(campaign.minimumContribution),
                                maxInvestment: ethers.formatEther(campaign.maximumContribution)
                            };
                            
                            activeCampaigns.push(campaignInfo);
                            campaignDetails.set(i, campaignInfo);
                            
                            // è·å–é¡¹ç›®å½“å‰ä½™é¢ï¼ˆæ¨¡æ‹Ÿï¼‰
                            const balance = await getCampaignBalance(i);
                            campaignBalances.set(i, balance);
                        }
                    } catch (err) {
                        console.log(`è·³è¿‡é¡¹ç›® ${i}:`, err.message);
                        continue;
                    }
                }
                
                if (activeCampaigns.length === 0) {
                    console.log('æœªæ‰¾åˆ°æ´»è·ƒé¡¹ç›®ï¼ŒåŠ è½½æ¼”ç¤ºæ•°æ®');
                    loadDemoCampaigns();
                } else {
                    console.log(`æˆåŠŸåŠ è½½ ${activeCampaigns.length} ä¸ªé¡¹ç›®`);
                }
                
                updateCampaignsDisplay();
            } catch (error) {
                console.error('åŠ è½½é¡¹ç›®å¤±è´¥:', error);
                loadDemoCampaigns();
            }
        }
        
        function loadDemoCampaigns() {
            // åŠ è½½æ¼”ç¤ºé¡¹ç›®æ•°æ®
            activeCampaigns = [
                {
                    campaignId: 1,
                    name: 'DeFi Protocol X',
                    description: 'ä¸‹ä¸€ä»£å»ä¸­å¿ƒåŒ–å€Ÿè´·åè®®ï¼Œæ”¯æŒå¤šé“¾èµ„äº§å’Œåˆ›æ–°çš„æµåŠ¨æ€§æŒ–çŸ¿æœºåˆ¶ã€‚',
                    fundingGoal: '500',
                    tokenPrice: '0.01',
                    totalBackers: 128,
                    isLive: true,
                    endTime: Date.now() / 1000 + 15 * 24 * 60 * 60, // 15å¤©å
                    minInvestment: '0.01',
                    progress: 85
                },
                {
                    campaignId: 2,
                    name: 'GameFi Universe',
                    description: 'å…ƒå®‡å®™æ¸¸æˆå¹³å°ï¼Œé›†æˆ NFT äº¤æ˜“å’Œ Play-to-Earn æœºåˆ¶ã€‚',
                    fundingGoal: '1000',
                    tokenPrice: '0.005',
                    totalBackers: 256,
                    isLive: true,
                    endTime: Date.now() / 1000 + 28 * 24 * 60 * 60, // 28å¤©å
                    minInvestment: '0.01',
                    progress: 42
                },
                {
                    campaignId: 3,
                    name: 'AI Trading Bot',
                    description: 'åŸºäºæœºå™¨å­¦ä¹ çš„æ™ºèƒ½äº¤æ˜“æœºå™¨äººï¼Œæ”¯æŒå¤šç§äº¤æ˜“ç­–ç•¥ã€‚',
                    fundingGoal: '300',
                    tokenPrice: '0.02',
                    totalBackers: 64,
                    isLive: true,
                    endTime: Date.now() / 1000 + 45 * 24 * 60 * 60, // 45å¤©å
                    minInvestment: '0.01',
                    progress: 12
                }
            ];
            
            // æ¨¡æ‹Ÿé¡¹ç›®ä½™é¢
            campaignBalances.set(1, (500 * 0.85).toString()); // 85% progress
            campaignBalances.set(2, (1000 * 0.42).toString()); // 42% progress  
            campaignBalances.set(3, (300 * 0.12).toString()); // 12% progress
            
            activeCampaigns.forEach(campaign => {
                campaignDetails.set(campaign.campaignId, campaign);
            });
        }
        
        async function getCampaignBalance(campaignId) {
            try {
                if (!isConnected || !provider) {
                    // è¿”å›æ¨¡æ‹Ÿä½™é¢
                    const campaign = campaignDetails.get(campaignId);
                    if (campaign && campaign.progress) {
                        return (parseFloat(campaign.fundingGoal) * campaign.progress / 100).toString();
                    }
                    return '0';
                }
                
                // å®é™…ä»åŒºå—é“¾è·å–ä½™é¢çš„é€»è¾‘
                const balance = await provider.getBalance(CONTRACT_ADDRESSES.CRYPTOLAUNCH);
                return ethers.formatEther(balance);
            } catch (error) {
                console.error('è·å–é¡¹ç›®ä½™é¢å¤±è´¥:', error);
                return '0';
            }
        }
        
        function updateCampaignsDisplay() {
            console.log('æ›´æ–°é¡¹ç›®æ˜¾ç¤º:', activeCampaigns);
            
            const campaignsContainer = document.getElementById('campaigns');
            if (!campaignsContainer) return;
            
            // æ‰¾åˆ°é¡¹ç›®ç½‘æ ¼å®¹å™¨
            let projectGrid = campaignsContainer.querySelector('.grid');
            if (!projectGrid) return;
            
            // æ¸…ç©ºç°æœ‰é¡¹ç›®ï¼ˆä¿ç•™æ ‡é¢˜éƒ¨åˆ†ï¼‰
            projectGrid.innerHTML = '';
            
            // ç”Ÿæˆé¡¹ç›®å¡ç‰‡
            activeCampaigns.forEach((campaign, index) => {
                const progress = calculateProgress(campaign);
                const remainingDays = calculateRemainingDays(campaign.endTime);
                const currentBalance = campaignBalances.get(campaign.campaignId) || '0';
                
                const projectCard = createProjectCard(campaign, progress, remainingDays, currentBalance, index);
                projectGrid.appendChild(projectCard);
            });
            
            if (activeCampaigns.length === 0) {
                projectGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-6xl mb-4">ğŸš€</div>
                        <h3 class="text-xl font-semibold mb-2">æš‚æ— æ´»è·ƒé¡¹ç›®</h3>
                        <p class="text-gray-400 mb-4">æˆä¸ºç¬¬ä¸€ä¸ªåˆ›å»ºé¡¹ç›®çš„äººï¼</p>
                        <button onclick="showSection('launch')" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg">
                            åˆ›å»ºé¡¹ç›®
                        </button>
                    </div>
                `;
            }
        }
        
        function calculateProgress(campaign) {
            if (campaign.progress) return campaign.progress;
            
            const balance = parseFloat(campaignBalances.get(campaign.campaignId) || '0');
            const goal = parseFloat(campaign.fundingGoal);
            return goal > 0 ? Math.min((balance / goal) * 100, 100) : 0;
        }
        
        function calculateRemainingDays(endTime) {
            const now = Date.now() / 1000;
            const remaining = endTime - now;
            return remaining > 0 ? Math.ceil(remaining / (24 * 60 * 60)) : 0;
        }
        
        function createProjectCard(campaign, progress, remainingDays, currentBalance, index) {
            const div = document.createElement('div');
            const colors = ['blue', 'purple', 'green'];
            const color = colors[index % colors.length];
            const statusLabels = ['æ´»è·ƒ', 'çƒ­é—¨', 'æ–°ä¸Šçº¿'];
            const statusLabel = statusLabels[index % statusLabels.length];
            const statusColors = ['green', 'yellow', 'blue'];
            const statusColor = statusColors[index % statusColors.length];
            
            div.className = `bg-gray-700 rounded-xl border border-gray-600 p-6 hover:border-${color}-500 transition-colors transform hover:scale-105 duration-200`;
            
            div.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-lg font-semibold">${campaign.name}</h4>
                    <span class="bg-${statusColor}-500 text-white px-2 py-1 rounded text-xs">${statusLabel}</span>
                </div>
                
                <p class="text-gray-300 text-sm mb-4 line-clamp-3">
                    ${campaign.description}
                </p>
                
                <div class="space-y-2 mb-4">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-400">ç­¹æ¬¾è¿›åº¦</span>
                        <span class="text-white font-medium">${progress.toFixed(1)}%</span>
                    </div>
                    <div class="w-full bg-gray-600 rounded-full h-2">
                        <div class="bg-gradient-to-r from-${color}-500 to-${color}-400 h-2 rounded-full transition-all duration-500" 
                             style="width: ${Math.min(progress, 100)}%"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-400">ç›®æ ‡:</span>
                            <span class="text-white font-medium">${campaign.fundingGoal} ETH</span>
                        </div>
                        <div>
                            <span class="text-gray-400">å·²ç­¹:</span>
                            <span class="text-green-400 font-medium" id="balance-${campaign.campaignId}">${parseFloat(currentBalance).toFixed(3)} ETH</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-400">æŠ•èµ„äºº:</span>
                            <span class="text-white font-medium" id="backers-${campaign.campaignId}">${campaign.totalBackers || 0}</span>
                        </div>
                        <div>
                            <span class="text-gray-400">å‰©ä½™:</span>
                            <span class="text-orange-400 font-medium">${remainingDays} å¤©</span>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-2">
                    <button onclick="showInvestmentModal('${campaign.name}', ${campaign.campaignId})" 
                            class="flex-1 bg-${color}-600 hover:bg-${color}-700 text-white px-4 py-2 rounded-lg transition-colors text-sm font-medium">
                        ğŸ” æœºå¯†æŠ•èµ„
                    </button>
                    <button onclick="makeDonation('${campaign.name}', ${campaign.campaignId})" 
                            class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors text-sm font-medium">
                        â¤ï¸ ææ¬¾
                    </button>
                </div>
                
                <div class="mt-3 text-xs text-center text-gray-500">
                    é¡¹ç›®ID: #${campaign.campaignId} | æœ€å°æŠ•èµ„: ${campaign.minInvestment || '0.01'} ETH
                </div>
            `;
            
            return div;
        }
        
        // Toast notifications
        function showToast(message, type = 'info') {
            // Create container if it doesn't exist
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.className = 'fixed top-4 right-4 z-50 space-y-2';
                document.body.appendChild(container);
            }
            
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-600' : 
                          type === 'error' ? 'bg-red-600' : 'bg-blue-600';
            
            toast.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-lg transition-all duration-300`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 4000);
        }

        // Initialize
        document.getElementById('connectWallet').addEventListener('click', connectWallet);
        
        // Navigation
        document.querySelectorAll('nav a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const sectionName = this.getAttribute('href').substring(1);
                showSection(sectionName);
            });
        });
        
        // Check for section parameter from demo.html
        document.addEventListener('DOMContentLoaded', function() {
            const savedSection = sessionStorage.getItem('showSection');
            const urlHash = window.location.hash.substring(1);
            
            // åˆå§‹åŒ–åŠ è½½æ¼”ç¤ºé¡¹ç›®æ•°æ®
            loadDemoCampaigns();
            updateCampaignsDisplay();
            
            if (savedSection) {
                sessionStorage.removeItem('showSection');
                showSection(savedSection);
            } else if (urlHash && ['launch', 'campaigns', 'dex'].includes(urlHash)) {
                showSection(urlHash);
            }
        });

        // Auto-detect wallet
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', function(accounts) {
                if (accounts.length === 0) {
                    isConnected = false;
                    userAccount = '';
                    provider = null;
                    signer = null;
                    document.getElementById('connectWallet').textContent = 'è¿æ¥é’±åŒ…';
                    document.getElementById('connectWallet').classList.remove('bg-green-600', 'hover:bg-green-700');
                    document.getElementById('connectWallet').classList.add('bg-blue-600', 'hover:bg-blue-700');
                    document.getElementById('walletInfo').classList.add('hidden');
                    document.getElementById('balanceInfo').classList.add('hidden');
                }
            });
        }
    </script>
</body>
</html>